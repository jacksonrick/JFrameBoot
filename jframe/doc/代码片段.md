# 常用代码片段
## JAVA

`private final static Logger log = LoggerFactory.getLogger(LogManager.class);`
    
```
InputStream is = VERSION.class.getResourceAsStream("/VERSION");
new PathMatchingResourcePatternResolver().getResource("1.txt");
```

```
#读取文件(Spring)
ClassPathResource resource = new ClassPathResource("1.txt");
this.certData = FileCopyUtils.copyToByteArray(resource.getInputStream());
```

```
WebApplicationContext webApplicationContext = ContextLoader.getCurrentWebApplicationContext();
ServletContext servletContext = webApplicationContext.getServletContext();
```

```
分页：
    原始：
        int total = userMapper.findCountByCondition(condition);
        List<User> list = userMapper.findByCondition(condition);
        return new Pagination(list, total, condition.getPageNo(), condition.getPageSize());

    现：APP或者JSON数据的分页，使用PageHelper -> PageInfo作为数据载体
        *只有pageNo和PageSize同时存在，才会调用分页 【设置 condition.setPage(true) 开启分页查询】
           List查询后直接调用 return new PageInfo(list);
        *如果出现子查询分页，需要手动写分页代码
```

```
freemarker
    引用：<#include "include.ftl"/> 【不需要相对路径】
    标签：${convert("key","*********")}
         ${convert("phone","17730215423")}
         ${convert("idcard","340123199311012674")}
    指令：<@pagination form="queryForm" data=page> </@pagination>  【标签中间必须要有空格】
    Freemarker基本用法：http://blog.csdn.net/u011118289/article/details/43306015
```

---

## Linux
    
`nohup java -jar jframe-web-app.jar --spring.profiles.active=dev &`

`java -Xms10m -Xmx80m`

`exec java -server -jar jframe-web-manage.jar --spring.profiles.active=pro 5 > run.log &`

---

## SQL

```
#日期格式化查询
date_format(regDate,"%Y-%m-%d") between date_format(#{maps.date1},"%Y-%m-%d") and date_format(adddate(#{maps.date2},1),"%Y-%m-%d")
```

```
#in查询
<if test="maps.ids!=null">
    and id in
    <foreach item="idx" collection="maps.ids" open="(" separator="," close=")"> #{idx} </foreach>
</if>
<foreach item="idx" collection="maps.ids" open="(" separator="," close=")"> #{idx} </foreach>
```

```
#动态更新
update t_user
<set>
    <if test != null and != ''"> = #{},</if>
</set>
where
```

```
###返回插入主键
<selectKey keyProperty="id" order="AFTER" resultType="int">
    SELECT LAST_INSERT_ID()
</selectKey>
或(推荐)：
<insert id="insertUser" parameterType="user" keyProperty="id" useGeneratedKeys="true"></insert>
```

```
#批量插入
<insert id="insertItems" parameterType="list">
    insert into t_items(productId,orderId,count,price,totalPrice) values
    <foreach collection="list" item="item" separator=",">
        (#{item.product.id},#{item.order.id},#{item.count},#{item.price},#{item.totalPrice})
    </foreach>
</insert>
```

```
#按年月季周日统计
<if test="type == 1">
    SELECT DAY(a.user_create_time) AS `x`,COUNT(a.id) AS `y`
    FROM t_user a
    WHERE DATE_FORMAT(a.user_create_time,"%Y-%m-%d") = DATE_FORMAT(NOW(),"%Y-%m-%d")
    GROUP BY `x`
    ORDER BY `x` ASC
</if>
<if test="type == 2">
    SELECT DAY(a.user_create_time) AS `x`,COUNT(a.id) AS `y`
    FROM t_user a
    WHERE YEARWEEK(DATE_FORMAT(a.user_create_time,"%Y-%m-%d")) = YEARWEEK(NOW())
    GROUP BY `x`
    ORDER BY `x` ASC
</if>
<if test="type == 3">
    SELECT DAY(a.user_create_time) AS `x`,COUNT(a.id) AS `y`
    FROM t_user a
    WHERE DATE_FORMAT(a.user_create_time,"%Y-%m") = DATE_FORMAT(NOW(),"%Y-%m")
    GROUP BY `x`
    ORDER BY `x` ASC
</if>
<if test="type == 4">
    SELECT MONTH(a.user_create_time) AS `x`,COUNT(a.id) AS `y`
    FROM t_user a
    WHERE a.user_create_time BETWEEN DATE_SUB(NOW(), INTERVAL 3 month) AND NOW()
    GROUP BY `x`
    ORDER BY `x` ASC
</if>
```

---

## EL
```
<fmt:formatNumber value="${price }" pattern="##.##" minFractionDigits="2" ></fmt:formatNumber>
	
<fmt:formatDate value="${d.date }" pattern="yyyy-MM-dd HH:mm:ss" var="date"></fmt:formatDate>

${fn:substring(str,0,20)}
${fn:length(list)}

<c:forTokens items="${str}" delims="," var="v"> 
    ${v}
</c:forTokens>

<c:choose>
    <c:when test="${5<2 }"></c:when>
    <c:otherwise></c:otherwise>
</c:choose>

<!-- 三元表达式 -->
<option value="" ${empty type?'selected':'' }>ALL</option>
<option value="1" ${type eq 1?'selected':'' }>1</option>
${con == null? '' : con?'+':'-' }
```

---

## HTML/JS

```
HTML5低版本浏览器 head标签内
<!--[if lt IE 9]>
	<script src="../dist/js/vendor/html5shiv.js"></script>
	<script src="../dist/js/vendor/respond.min.js"></script>
<![endif]-->
```

#### Echarts

JS版-折线图：

```
function stat(){
    var myChart = echarts.init(document.getElementById('chart'));
    myChart.showLoading({text : '正在努力的读取数据中...'});

    Ajax.ajax({
        url: "/",
        params: null,
        success: function(data) {
            if (data.code == 0) {
                myChart.setOption(
                    option = {
                        title: {
                            text: '会员统计'
                        },
                        tooltip : {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross',
                                label: {
                                    backgroundColor: '#6a7985'
                                }
                            },
                            //data.data.date + (data.data.date==""?'':'-') +
                            formatter: "{b} <br/> {a}:{c}"
                        },
                        legend: {
                            data:['会员']
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        xAxis : [
                            {
                                name : '日期',
                                type : 'category',
                                boundaryGap : true,
                                data : data.data.x
                            }
                        ],
                        yAxis : [
                            {
                                name : '人',
                                type : 'value'
                            }
                        ],
                        series : [
                            {
                                name:'会员',
                                type:'line',
                                stack: '总数',
                                label: {
                                    normal: {
                                        show: true,
                                        position: 'top'
                                    }
                                },
                                areaStyle: {normal: {
                                    opacity: '0'
                                }},
                                data:data.data.y
                            }
                        ]
                    }

                )
            } else {
                showMsg("未查询到数据", 2);
                myChart.dispose();
            }
            myChart.hideLoading();
        }
    });
}
```

JS版-饼图：

```
function stat(){
    var myChart = echarts.init(document.getElementById('chart5'));
    myChart.showLoading({text : '正在努力的读取数据中...'});

    Ajax.ajax({
        url: "/",
        params: null,
        success: function(data) {
            if (data.code == 0) {
                myChart.setOption(
                    option = {
                        title : {
                            text: '会员分布统计',
                            subtext: '男女比例',
                            x:'center'
                        },
                        tooltip : {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left',
                            data: ['其他','女','男']
                        },
                        series : [
                            {
                                name: '人数',
                                type: 'pie',
                                radius : '55%',
                                center: ['50%', '60%'],
                                data:[
                                    {value:data.data.y[0], name:'其他'},
                                    {value:data.data.y[1], name:'女'},
                                    {value:data.data.y[2], name:'男'}
                                ],
                                itemStyle: {
                                    emphasis: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }
                        ]
                    }
                )
            } else {
                showMsg("未查询到数据", 2);
                myChart.dispose();
            }
            myChart.hideLoading();
        }
    });
}
```


```
Echarts:
	·提示框与格式化 [a-name,b-key,c-value,d-other]
	·工具箱 - 辅助线、数据预览、图表切换、重置、保存为图片
		feature(Tool.mark, new MagicType(Magic.bar, Magic.line), Tool.restore, Tool.saveAsImage)
	·当坐标轴y轴为负数时使用格式化 
		axisLabel(new AxisLabel().formatter("function(v){return -v;}"))
	·副标题.subtext()	
```

JAVA版-柱状图示例：

```	
public EnhancedOption find...Line(String date) {
	EnhancedOption option = new EnhancedOption();
	// 可计算
	option.calculable(true);
	// 标题
	option.title().text(date + " 充值统计曲线图").x(X.center);

	// 图例
	option.legend("金额", "人数").legend().x(X.center).y(Y.bottom);

	// 工具箱 - 辅助线、数据预览、图表切换、重置、保存为图片
	option.toolbox().show(true).feature(Tool.mark, new MagicType(Magic.bar, Magic.line), Tool.restore, Tool.saveAsImage).x(X.right).y(Y.bottom);
	// 浮动提示框与格式化
	option.tooltip().trigger(Trigger.axis).formatter("{b}月<br/>{a}：{c}元 <br/>{a1}：{c1}人");

	// x轴
	CategoryAxis xAxis = new CategoryAxis();
	// 最大最小值
	xAxis.min(1).max(12).name("月份").splitLine().show(true);
	// boundaryGap
	xAxis.boundaryGap(true).axisLine().onZero(false);
	option.xAxis(xAxis);

	// y轴1
	ValueAxis yAxis1 = new ValueAxis();
	// y轴名称和最小最大值
	// y轴坐标轴
	yAxis1.name("金额").min(0).axisLabel().formatter("{value}");
	option.yAxis(yAxis1);

	// y轴2
	ValueAxis yAxis2 = new ValueAxis();
	yAxis2.name("人数").min(0);
	option.yAxis(yAxis2);

	// 折线Line 柱状Bar
	Line line1 = new Line("金额").type(SeriesType.bar);
	// 曲线样式和显示标签并格式化
	line1.itemStyle().normal().label().show(true).formatter("{b}月：{c}元");
	Line line2 = new Line("人数").type(SeriesType.bar);
	line2.yAxisIndex(1).itemStyle().normal().label().show(true).formatter("{b}月：{c}人");

	// 加载数据 - x轴和多曲线数据
	List<FundStat> list = statisMapper.findChargeYearStat(date);
	for (FundStat product : list) {
		xAxis.data(product.getMonth());
		line1.data(product.getMoney());
		line2.data(product.getCount());
	}
	// 设置series
	option.series(line1);
	option.series(line2);
	return option;
}
```
	
JAVA版-饼图示例：

```
public EnhancedOption find...Pie() {
	List<ProductStat> list = statisMapper.findProductCountStat();
	EnhancedOption option = new EnhancedOption();

	option.title().text("各分类商品总量占比").x(X.center);
	option.tooltip().trigger(Trigger.item).formatter("{b}：{c}件");

	// 设置样式 阴影
	option.itemStyle().normal().shadowBlur(200).shadowOffsetX(0).shadowOffsetY(0).shadowColor("rgba(0, 0, 0, 0.5)");

	List<String> led = new ArrayList<String>();
	for (ProductStat stat : list) {
		led.add(stat.getName());
	}
	// 设置图例
	option.legend().x(X.center).y(Y.bottom).orient(Orient.horizontal).data(led);

	// 饼图
	Pie pie = new Pie();
	pie.name("月销售额");
	for (ProductStat stat : list) {
		pie.data(new PieData(stat.getName(), stat.getCount()));
	}

	// 标签
	pie.label().normal().show(true).formatter("{b}：{c}件({d}%)");
	option.series(pie);
	return option;
}
```

